@{
    ViewData["Title"] = "Điểm danh bằng khuôn mặt";
}

<div class="container mt-4">
    <h2 class="text-success">Điểm danh bằng khuôn mặt</h2>

    <div class="border p-3 mb-3">
        <video id="video" width="400" height="300" autoplay class="border"></video>
        <canvas id="canvas" style="display:none;"></canvas>
        <br />
        <button id="snap" class="btn btn-success mt-2">Chụp & điểm danh</button>
    </div>

    <div id="result" class="mt-3"></div>
</div>

<script>
    const video = document.getElementById("video");
    const canvas = document.getElementById("canvas");
    const snap = document.getElementById("snap");
    const resultDiv = document.getElementById("result");

    // Mở camera
    navigator.mediaDevices.getUserMedia({ video: true })
        .then((stream) => {
            video.srcObject = stream;
        })
        .catch((err) => {
            alert("Không thể mở camera: " + err);
        });

    // Chụp ảnh và gửi lên server
    snap.onclick = function () {
        const context = canvas.getContext("2d");
        canvas.width = video.videoWidth;
        canvas.height = video.videoHeight;
        context.drawImage(video, 0, 0, canvas.width, canvas.height);

        const imageData = canvas.toDataURL("image/png");

        fetch('/FaceRecognition/Recognize', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({ base64Image: imageData })
        })
            .then(res => res.json())
            .then(data => {
                resultDiv.innerHTML = `<div class="alert ${data.success ? 'alert-success' : 'alert-danger'}">${data.message}</div>`;
            })
            .catch(err => {
                resultDiv.innerHTML = `<div class="alert alert-danger">Lỗi khi gửi ảnh: ${err}</div>`;
            });
    };
</script>

